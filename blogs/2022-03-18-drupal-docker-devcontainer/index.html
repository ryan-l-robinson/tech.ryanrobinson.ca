<p>I have previously shared <a href="/websites/vagrant-oracle-linux-vm/">setting up local development environments using vagrant</a> and <a href="/tags/gitpod-drupal/">GitPod</a> in Drupal friendly ways. This post will start a new mini-series on how I built a Docker Desktop setup for a Drupal-friendly environment that is (mostly) based on Oracle Linux 8.</p>
<p>Code for this is found in <a href="https://github.com/ryan-l-robinson/Drupal-Devcontainer">my GitHub</a>.</p>
<h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview">#</a></h2>
<p>There will need to be several files to make this work:</p>
<ul>
<li>devcontainer.json for how to integrate with <a href="/tags/visual-studio-code/">VS Code</a></li>
<li>Docker-compose.yml for how to tie together all the different containers</li>
<li>web.Dockerfile for the primary Apache container (Oracle Linux based)</li>
<li>php.Dockerfile for the PHP-FPM container (Oracle Linux based)</li>
<li>db.Dockerfile for the MariaDB database container (a simpler image from an official MariaDB image)</li>
</ul>
<h2 id="devcontainer-json" tabindex="-1">Devcontainer.json <a class="header-anchor" href="#devcontainer-json">#</a></h2>
<p>I’ll start at the first file which gets called when you open VS Code: the .devcontainer/devcontainer.json.</p>
<p>The most important pieces are near the top. This includes:</p>
<p>Where to find the Docker composer file:</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">  "dockerComposeFile": "../docker-compose.yml",</code></pre>
<p>What user to connect as:</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">  "remoteUser": "drupal",</code></pre>
<p>What service to connect to and what other services to start up in the background:</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">  "service": "web",
  "runServices": ["web", "php", "db"],</code></pre>
<p>In my case, my primary is called web for the main Apache container, with two other services for PHP and DB (MariaDB).</p>
<p>What location on the container should be your workspace after connecting:</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">  "workspaceFolder": "/var/www/html",</code></pre>
<p>You can also define what extensions and settings should be installed in this container. Unlike <a href="/websites/drupal/drupal-gitpod-container-2-gitpod-yml/">the GitPod equivalent</a>, this can be any VS Code extension, not only the Open VSX ones. I’ve written <a href="/websites/favourite-visual-studio-code-extensions/">some of my favourite extensions in the past</a>, but this is a good sample of some I use specifically with Drupal:</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">    "extensions": [
      "gruntfuggly.todo-tree",
      "eamodio.gitlens",
      "gitkraken.gitkraken-authentication",
      "cweijan.vscode-mysql-client2",
      "esbenp.prettier-vscode",
      "whatwedo.twig",
      "marcostazi.vs-code-drupal",
      "github.copilot",
      "vscode-icons-team.vscode-icons",
      "xdebug.php-debug",
    ],</code></pre>
<h3 id="scripts" tabindex="-1">Scripts <a class="header-anchor" href="#scripts">#</a></h3>
<p>You can trigger other scripts to run at various points in the process.</p>
<p>The primary one I made use of is postCreateCommand. This will run only once when the container is first built. This one is much more complicated building the entire site. I’ll have another post dedicated to that script.</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">    "postCreateCommand": "/bin/bash -c \"/postCreateCommand.sh\"",</code></pre>
<p>I also have a much simpler postAttachCommand. This only sources the ~/.bashrc to ensure the user knows where to find commands like drush and composer, which were set up by the postCreateCommand script.</p>
<pre class="language-devcontainer" tabindex="0"><code class="language-devcontainer">    "postAttachCommand": "/bin/bash -c \"source ~/.bashrc\"",</code></pre>
